<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-t-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#F97316">
    <title>MastroPizza - Pergamino</title>
    <link rel="icon" type="image/png" href="https://archive.org/download/favicom-01/favicom-01.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'brand-bg': '#111827',
              'brand-header': '#231F20',
              'brand-card': '#1F2937',
              'brand-text': '#F3F4F6',
              'brand-text-light': '#9CA3AF',
              'brand-accent': '#F97316', // Orange-500
              'brand-teal': '#14B8A6', // Teal-500 for MastroPizza
            },
            fontWeight: {
              'extralight': 200,
            },
            animation: {
              'fade-in-up': 'fade-in-up 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both',
              'fade-in': 'fade-in 0.3s ease-out both',
            },
            keyframes: {
              'fade-in-up': {
                '0%': { 
                  opacity: '0', 
                  transform: 'translateY(20px) scale(0.95)' 
                },
                '100%': { 
                  opacity: '1', 
                  transform: 'translateY(0) scale(1)' 
                },
              },
              'fade-in': {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              }
            }
          }
        }
      }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Montserrat', sans-serif;
        font-weight: 300;
        background-image: url('https://ia601009.us.archive.org/25/items/fondo-mesa-de-trabajo-1-mesa-de-trabajo-1/fondo_Mesa%20de%20trabajo%201_Mesa%20de%20trabajo%201.jpg');
        background-size: cover;
        background-position: center center;
        background-attachment: fixed;
      }
      .font-display {
        font-family: 'Montserrat', sans-serif;
      }
      /* Hide scrollbar for Chrome, Safari and Opera */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      /* Hide scrollbar for IE, Edge and Firefox */
      .no-scrollbar {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
      }
      .tabular-nums {
        font-variant-numeric: tabular-nums;
      }

      /* Unified mobile-first view with glassmorphism */
      .bg-brand-bg {
        background-color: transparent !important;
      }
      .bg-brand-header,
      .bg-brand-card {
        -webkit-backdrop-filter: blur(12px);
        backdrop-filter: blur(12px);
      }

      .bg-brand-header {
        background-color: rgba(35, 31, 32, 0.75) !important; /* #231F20 with opacity */
      }

      .bg-brand-card {
        background-color: rgba(31, 41, 55, 0.75) !important; /* #1F2937 with opacity */
      }

      .hover\\:bg-gray-700:hover {
        background-color: rgba(55, 65, 81, 0.75) !important; /* gray-700 with opacity */
      }

      /* Adjust border colors to match the new transparent theme */
      .border-gray-700 {
        border-color: rgba(243, 244, 246, 0.15) !important; /* brand-text with low opacity */
      }
      .border-gray-600 {
        border-color: rgba(243, 244, 246, 0.2) !important; /* brand-text with slightly higher opacity for inputs */
      }
      
      .border-b-2.border-brand-accent\\/30 {
          border-color: rgba(249, 115, 22, 0.5) !important; /* brand-accent with higher opacity */
      }
    </style>
    <!-- React and Babel for in-browser transpilation -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-brand-bg text-brand-text">
    <div id="root"></div>
    <script type="text/babel">
      // React Hooks
      const { useState, useEffect, useRef, useCallback, useMemo } = React;

      // --- HELPERS ---
      const formatPrice = (price) => {
        return new Intl.NumberFormat('es-AR', {
          style: 'currency',
          currency: 'ARS',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        }).format(price);
      };

      const SHIPPING_COST = 1000;
      const WHATSAPP_NUMBER = '5492477238364';

      // --- DATA ---
      const Category = {
        Todos: 'Todos',
        Pizzas: 'Pizzas',
        Hamburguesas: 'Hamburguesas',
        Sanguches: 'Sánguches',
      };

      const menuItems = [
        {
          id: 1000,
          name: 'Combo Mini Mastro',
          category: Category.Pizzas,
          description: 'Mini pizza de 3 porciones + gaseosa de 500ml',
          price: 1000,
          imageUrls: ['https://scontent.faep9-1.fna.fbcdn.net/v/t39.30808-6/435626298_951071273685651_118182989182069670_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=5f2048&_nc_ohc=u0Z_W0_y4JgQ7kNvgH0hXfA&_nc_ht=scontent.faep9-1.fna&oh=00_AYC2vV44IqW2tY7jR_p4r64EwzM7rD6kL3rVv2D_D-n_OQ&oe=66736458'],
          isPromo: true,
        },
        // MastroPizzas
        {
          id: 901,
          name: 'Mastropizza de 12 porciones, hasta 4 sabores',
          category: Category.Pizzas,
          description: '¡Pizza gigante para compartir! Elige hasta 4 sabores distintos.',
          price: 18000,
          imageUrls: ['https://s2-oglobo.glbimg.com/5d4BjkYykotKFxtGv41iLOMOp8A=/0x0:2355x1592/888x0/smart/filters:strip_icc()/i.s3.glbimg.com/v1/AUTH_da025474c0c44edd99332dddb09cabe8/internal_photos/bs/2024/Z/T/Bo7lsdTdKS8PEdYuautg/107608847.jpg'],
          isMastro: true,
          portions: 12,
        },
        {
          id: 903,
          name: 'Mastropizza de 12 porciones, hasta 3 sabores',
          category: Category.Pizzas,
          description: '¡Pizza gigante para compartir! Elige hasta 3 sabores de 4 porciones cada uno.',
          price: 18000,
          imageUrls: ['https://s2-oglobo.glbimg.com/5d4BjkYykotKFxtGv41iLOMOp8A=/0x0:2355x1592/888x0/smart/filters:strip_icc()/i.s3.glbimg.com/v1/AUTH_da025474c0c44edd99332dddb09cabe8/internal_photos/bs/2024/Z/T/Bo7lsdTdKS8PEdYuautg/107608847.jpg'],
          isMastro: true,
          portions: 12,
        },
        {
          id: 902,
          name: 'Mastropizza de 6 porciones, hasta 2 sabores',
          category: Category.Pizzas,
          description: '¡Mitad y mitad! Elige hasta 2 sabores.',
          price: 10500,
          imageUrls: ['https://s2-oglobo.glbimg.com/5d4BjkYykotKFxtGv41iLOMOp8A=/0x0:2355x1592/888x0/smart/filters:strip_icc()/i.s3.glbimg.com/v1/AUTH_da025474c0c44edd99332dddb09cabe8/internal_photos/bs/2024/Z/T/Bo7lsdTdKS8PEdYuautg/107608847.jpg'],
          isMastro: true,
          portions: 6,
        },
        {
          id: 904,
          name: 'Mastropizza de 3 porciones, 1 sabor',
          category: Category.Pizzas,
          description: '¡Un cuarto de pizza! Elige tu sabor favorito.',
          price: 5000,
          imageUrls: ['https://s2-oglobo.glbimg.com/5d4BjkYykotKFxtGv41iLOMOp8A=/0x0:2355x1592/888x0/smart/filters:strip_icc()/i.s3.glbimg.com/v1/AUTH_da025474c0c44edd99332dddb09cabe8/internal_photos/bs/2024/Z/T/Bo7lsdTdKS8PEdYuautg/107608847.jpg'],
          isMastro: true,
          portions: 3,
        },
        // Pizzas
        { id: 101, name: 'Pizza de Acelga y Roquefort', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, acelga, roquefort, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'acelga', 'roquefort', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 102, name: 'Pizza de Ananá', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, ananá, azúcar negra.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'ananá', 'azúcar negra'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 103, name: 'Pizza de Ananá con Jamón', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón, ananá, azúcar negra.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón', 'ananá', 'azúcar negra'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 104, name: 'Pizza Afrodisiaca', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, anchoas, orégano, aceitunas.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'anchoas', 'orégano', 'aceitunas'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 105, name: 'Pizza de Atún', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, atún, morrón, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'atún', 'morrón', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 106, name: 'Pizza Bolognesa', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, longaniza, orégano y aceitunas.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'longaniza', 'orégano', 'aceitunas'], prepTime: '20-25 min', imageUrls: ['https://speedy.uenicdn.com/4c6d58bf-c626-4ade-85a5-5390e842a41a/c440_a/image/upload/v1612909110/business/f919def1-92cc-4aaa-906d-07447acb469b.jpg']},
        { id: 107, name: 'Pizza Calabresa con Morrón', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, longaniza, morrón, orégano, aceitunas.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'longaniza', 'morrón', 'orégano', 'aceitunas'], prepTime: '20-25 min', imageUrls: ['https://speedy.uenicdn.com/4c6d58bf-c626-4ade-85a5-5390e842a41a/c440_a/image/upload/v1612909110/business/f919def1-92cc-4aaa-906d-07447acb469b.jpg']},
        { id: 108, name: 'Pizza de Cantimpalo con Morrón', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, cantimpalo, morrón, orégano, aceitunas.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'cantimpalo', 'morrón', 'orégano', 'aceitunas'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 109, name: 'Pizza de Choclo', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, choclo, orégano, aceitunas.', price: 17500, halfPrice: 9500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'choclo', 'orégano', 'aceitunas'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 110, name: 'Pizza de Choclo con Jamón', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón, choclo, orégano, aceitunas.', price: 17500, halfPrice: 9500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón', 'choclo', 'orégano', 'aceitunas'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 111, name: 'Pizza de Champiñones', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, champiñones, orégano, aceitunas.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'champiñones', 'orégano', 'aceitunas'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 112, name: 'Pizza Criolla', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, criolla, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'criolla', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 113, name: 'Pizza Cuatro Quesos', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, queso tibo, parmesano, roquefort, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'queso tibo', 'parmesano', 'roquefort', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 114, name: 'Pizza Especial', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón, huevo, morrón, orégano, aceituna.', price: 17500, halfPrice: 9500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón', 'huevo', 'morrón', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 115, name: 'Pizza Fugazza', category: Category.Pizzas, description: 'Cebolla, mozzarella, orégano y aceitunas.', price: 14000, halfPrice: 7500, quarterPrice: 5000, ingredients: ['Cebolla', 'mozzarella', 'orégano', 'aceitunas'], prepTime: '20-25 min', imageUrls: ['https://tofuu.getjusto.com/orioneat-local/resized2/8BmmxWrSsXHMr9Kpk-300-x.webp']},
        { id: 116, name: 'Pizza de Jamón Crudo', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón crudo, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón crudo', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 117, name: 'Pizza de Jamón Crudo y Rúcula', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón crudo, rúcula, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón crudo', 'rúcula', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 118, name: 'Pizza Mozzarella', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, orégano, aceituna.', price: 14000, halfPrice: 7500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 119, name: 'Pizza Mozzarella con Huevo', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, huevo duro, orégano, aceituna.', price: 17500, halfPrice: 9500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'huevo duro', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 120, name: 'Pizza Mozzarella con Morrón', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, morrón, orégano, aceituna.', price: 17500, halfPrice: 9500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'morrón', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 121, name: 'Pizza Mozzarella con Verdeo', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, cebolla de verdeo, orégano, aceituna.', price: 17500, halfPrice: 9500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'cebolla de verdeo', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 122, name: 'Pizza Mozzarella con Papitas', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, papitas pay.', price: 17500, halfPrice: 9500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'papitas pay'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 123, name: 'Pizza Mozzarella con Cheddar', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, queso cheddar, orégano, aceituna.', price: 17500, halfPrice: 9500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'queso cheddar', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 124, name: 'Pizza Napolitana', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, tomate, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'tomate', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://media.elgourmet.com/article/8metlvp345_portada-pizza.jpg']},
        { id: 125, name: 'Pizza Napolitana con Jamón', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón, tomate, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón', 'tomate', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://media.elgourmet.com/article/8metlvp345_portada-pizza.jpg']},
        { id: 126, name: 'Pizza Napolitana Especial', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón, huevo, morrón, tomate, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón', 'huevo', 'morrón', 'tomate', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://media.elgourmet.com/article/8metlvp345_portada-pizza.jpg']},
        { id: 127, name: 'Pizza Ojo de Buey', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, panceta, huevo frito, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'panceta', 'huevo frito', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 128, name: 'Pizza de Palmito', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, palmito, salsa golf, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'palmito', 'salsa golf', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 129, name: 'Pizza de Palmito con Jamón', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón, palmito, salsa golf, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón', 'palmito', 'salsa golf', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 130, name: 'Pizza de Panceta', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, panceta, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'panceta', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 131, name: 'Pizza de Panceta con Cheddar', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, cheddar, panceta, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'cheddar', 'panceta', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 132, name: 'Pizza de Panceta con Verdeo', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, panceta, cebolla de verdeo, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'panceta', 'cebolla de verdeo', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 133, name: 'Pizza de Panceta con Verdeo y Cheddar', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, panceta, cebolla de verdeo, cheddar, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'panceta', 'cebolla de verdeo', 'cheddar', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 134, name: 'Pizza Picante', category: Category.Pizzas, description: 'Salsa picante, mozzarella, ají molido, orégano y aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa picante', 'mozzarella', 'ají molido', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 135, name: 'Pizza de Pollo', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, pollo, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'pollo', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 136, name: 'Pizza de Pollo con Jamón', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón, pollo, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón', 'pollo', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 137, name: 'Pizza de Pollo con Salsa Roja', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, pollo con salsa roja, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'pollo con salsa roja', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 138, name: 'Pizza de Pollo con Verdeo', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, pollo con salsa blanca, cebolla de verdeo, morrón, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'pollo con salsa blanca', 'cebolla de verdeo', 'morrón', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 139, name: 'Pizza de Pollo con Champiñones', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, pollo, champiñón, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'pollo', 'champiñón', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 140, name: 'Pizza de Provolone', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, provolone, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'provolone', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 141, name: 'Pizza de Provolone con Jamón', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón, provolone, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón', 'provolone', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 142, name: 'Pizza Primavera', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, jamón cocido, cebolla de verdeo, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'jamón cocido', 'cebolla de verdeo', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 143, name: 'Pizza de Roquefort', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, roquefort, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'roquefort', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 144, name: 'Pizza con Salchicha', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, salchichas, papas pay.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'salchichas', 'papas pay'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 145, name: 'Pizza de Rúcula y Parmesano', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, rúcula, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'rúcula', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 146, name: 'Pizza de Verdura', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, acelga, salsa blanca, cebolla, morrón, parmesano, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'acelga', 'salsa blanca', 'cebolla', 'morrón', 'parmesano', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 147, name: 'Pizza de Provoleta', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, rúcula, parmesano, provoleta, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'rúcula', 'parmesano', 'provoleta', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 148, name: 'Pizza de Peperoni', category: Category.Pizzas, description: 'Salsa de tomate, mozzarella, peperoni, orégano, aceituna.', price: 18000, halfPrice: 10500, quarterPrice: 5000, ingredients: ['Salsa de tomate', 'mozzarella', 'peperoni', 'orégano', 'aceituna'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        // Hamburguesas
        { id: 5, name: 'Hamburguesa Simple', category: Category.Hamburguesas, description: 'Medallón de carne y queso, acompañada de papas fritas.', price: 100, ingredients: ['Medallón de carne', 'Queso', 'Papas fritas'], imageUrls: []},
        { id: 6, name: 'Hamburguesa Completa', category: Category.Hamburguesas, description: 'Medallón de carne, jamón, queso, huevo frito, tomate y lechuga, con papas fritas.', price: 100, ingredients: ['Medallón de carne', 'Jamón', 'Queso', 'Huevo frito', 'Tomate', 'Lechuga', 'Papas fritas'], imageUrls: []},
        { id: 7, name: 'Hamburguesa Panceta y Cheddar', category: Category.Hamburguesas, description: 'Medallón de carne, panceta, cheddar, huevo frito, tomate y lechuga, con papas fritas.', price: 100, ingredients: ['Medallón de carne', 'Panceta', 'Cheddar', 'Huevo frito', 'Tomate', 'Lechuga', 'Papas fritas'], imageUrls: []},
        { id: 8, name: 'Hamburguesa Criolla', category: Category.Hamburguesas, description: 'Medallón de carne, jamón, queso, cebolla, morrón, huevo frito, tomate y lechuga, con papas fritas.', price: 100, ingredients: ['Medallón de carne', 'Jamón', 'Queso', 'Cebolla', 'Morrón', 'Huevo frito', 'Tomate', 'Lechuga', 'Papas fritas'], imageUrls: []},
        // Sánguches
        { id: 301, name: 'Lomito', category: Category.Sanguches, description: 'Lomito, jamón, queso, huevo frito, lechuga, tomate, con papas fritas.', price: 100, ingredients: ['Pan', 'Lomito', 'Jamón', 'Queso', 'Huevo frito', 'Lechuga', 'Tomate', 'Papas fritas'], imageUrls: []},
        { id: 302, name: 'Juancho', category: Category.Sanguches, description: 'Jamón, queso, lechuga y tomate en pan de miga.', price: 100, ingredients: ['Pan de miga', 'Jamón', 'Queso', 'Lechuga', 'Tomate'], imageUrls: []},
        { id: 303, name: 'Sacramento', category: Category.Sanguches, description: 'Jamón, queso, lechuga y tomate en pan árabe.', price: 100, ingredients: ['Pan árabe', 'Jamón', 'Queso', 'Lechuga', 'Tomate'], imageUrls: []},
      ];

      const itemsById = menuItems.reduce((acc, item) => {
        acc[item.id] = item;
        return acc;
      }, {});

      // --- ICONS ---
      const GridIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>);
      const InfoIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>);
      const CartIcon = ({count}) => (
        <div className="relative">
          <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
          {count > 0 && (
            <span className="absolute -top-2 -right-2 bg-brand-accent text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">{count}</span>
          )}
        </div>
      );
      const WhatsAppIcon = () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" className="h-5 w-5 mr-2" fill="currentColor"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.8 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>;
      const ChevronLeftIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
      const PlusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>;
      const MinusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path fillRule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clipRule="evenodd" /></svg>;
      const MapPinIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>;
      const MapIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 16.382V5.618a1 1 0 00-1.447-.894L15 7m-6 0l6-3m0 0l-6-3m6 3l6 3" /></svg>;
      const TrashIcon = () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path fillRule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.576l.84-10.518.149.022a.75.75 0 10.23-1.482A41.31 41.31 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clipRule="evenodd" /></svg>;
      const PhoneIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>;

      // --- COMPONENTS ---

      function Header({ setView }) {
        const logoUrl = "https://ia601008.us.archive.org/22/items/logo-blanco-y-naranja-02/logo%20blanco%20y%20naranja-02.svg";
        return (
          <header className="bg-brand-header border-b border-gray-700 sticky top-0 z-20">
            {/* Mobile Header */}
            <div className="max-w-md mx-auto flex items-center justify-center h-[4.5rem] lg:hidden">
              <img src={logoUrl} alt="MastroPizza Logo" className="h-14 w-auto"/>
            </div>
            {/* Desktop Header */}
            <div className="hidden lg:flex max-w-7xl mx-auto items-center justify-between h-[4.5rem] px-8">
              <img src={logoUrl} alt="MastroPizza Logo" className="h-14 w-auto cursor-pointer" onClick={() => setView('menu')} />
              <nav className="flex items-center space-x-6">
                  <button onClick={() => setView('menu')} className="text-brand-text hover:text-brand-accent transition-colors font-medium">Menú</button>
                  <button onClick={() => setView('about')} className="text-brand-text hover:text-brand-accent transition-colors font-medium">Nosotros</button>
              </nav>
            </div>
          </header>
        );
      }
      
      function CategoryNav({ selectedCategory, setSelectedCategory }) {
        const categories = [Category.Todos, Category.Pizzas, Category.Hamburguesas, Category.Sanguches];
        const navRef = useRef(null);

        useEffect(() => {
            if (navRef.current) {
                const selectedButton = navRef.current.querySelector(`[data-category="${selectedCategory}"]`);
                if (selectedButton) {
                    selectedButton.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            }
        }, [selectedCategory]);

        return (
            <nav className="sticky top-[4.5rem] lg:top-0 bg-brand-header z-10 border-b border-t border-gray-700 lg:rounded-t-md">
                <div className="max-w-7xl mx-auto">
                  <div ref={navRef} className="flex space-x-1 overflow-x-auto no-scrollbar px-2">
                      {categories.map(category => (
                          <button
                              key={category}
                              data-category={category}
                              onClick={() => setSelectedCategory(category)}
                              className={`px-3 py-3 text-sm font-medium whitespace-nowrap transition-colors duration-200 border-b-2 ${
                                  selectedCategory === category 
                                  ? 'border-brand-accent text-brand-accent' 
                                  : 'border-transparent text-brand-text-light hover:text-brand-accent'
                              }`}
                          >
                              {category}
                          </button>
                      ))}
                  </div>
                </div>
            </nav>
        );
      }
      
      function MenuItemCard({ item, onSelect, onAdd, onAddHalf, onAddQuarter }) {
        const isStandardPizza = item.category === Category.Pizzas && !item.isMastro && item.halfPrice && item.quarterPrice;
        const hasImage = item.imageUrls && item.imageUrls.length > 0;

        const handleSelect = () => {
          if (item.isMastro) {
            onAdd(item);
          } else {
            onSelect(item);
          }
        };

        return (
            <div className={`bg-brand-card rounded-md border border-gray-700 overflow-hidden flex flex-col animate-fade-in-up transition-all hover:border-brand-accent/50`}>
              {hasImage && <img src={item.imageUrls[0]} alt={item.name} className="w-full h-40 object-cover cursor-pointer" onClick={handleSelect} />}
              <div className="p-4 flex flex-col flex-grow">
                <h3 className={`text-lg font-extralight text-brand-text flex-grow ${!hasImage ? 'cursor-pointer' : ''}`} onClick={!hasImage ? handleSelect : undefined}>
                  {item.name}
                </h3>
                <p className="text-brand-text-light text-sm mb-4 font-light">{item.description}</p>
                
                <div className="mt-auto pt-2">
                    {isStandardPizza ? (
                        <div className="grid grid-cols-3 gap-2 text-center">
                            {/* Column: Entera */}
                            <div className="flex flex-col items-center space-y-1">
                                <p className="font-semibold text-brand-text text-sm">Entera</p>
                                <span className="text-lg font-bold text-brand-accent">{formatPrice(item.price)}</span>
                                <button 
                                    onClick={() => onAdd(item)} 
                                    className="bg-brand-accent text-white w-full mt-1 py-2 rounded-md font-semibold hover:bg-orange-600 transition-all transform hover:scale-105 text-sm"
                                >
                                  Agregar
                                </button>
                            </div>
                            {/* Column: Media */}
                            <div className="flex flex-col items-center space-y-1">
                                <p className="font-semibold text-brand-text text-sm">Media</p>
                                <span className="text-lg font-bold text-brand-accent">{formatPrice(item.halfPrice)}</span>
                                <button 
                                    onClick={() => onAddHalf(item)} 
                                    className="bg-brand-accent text-white w-full mt-1 py-2 rounded-md font-semibold hover:bg-orange-600 transition-all transform hover:scale-105 text-sm"
                                >
                                  Agregar
                                </button>
                            </div>
                            {/* Column: Cuarto */}
                            <div className="flex flex-col items-center space-y-1">
                                <p className="font-semibold text-brand-text text-sm">Cuarto</p>
                                <span className="text-lg font-bold text-brand-accent">{formatPrice(item.quarterPrice)}</span>
                                <button 
                                    onClick={() => onAddQuarter(item)} 
                                    className="bg-brand-accent text-white w-full mt-1 py-2 rounded-md font-semibold hover:bg-orange-600 transition-all transform hover:scale-105 text-sm"
                                >
                                  Agregar
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div className="flex justify-between items-center">
                            { !item.isMastro && <span className="text-xl font-bold text-brand-accent">{formatPrice(item.price)}</span> }
                            <button 
                                onClick={() => onAdd(item)} 
                                className={`bg-brand-accent text-white py-2 rounded-md font-semibold hover:bg-orange-600 transition-all transform hover:scale-105 ${item.isMastro ? 'w-full' : 'px-4'}`}
                            >
                                {item.isMastro ? 'Armar Pizza' : 'Agregar'}
                            </button>
                        </div>
                    )}
                </div>
              </div>
            </div>
        );
      }

      function PizzaVisualizer({ baseItem, selectedFlavors = {} }) {
        const totalPortions = baseItem.portions;
        const isLargePizza = totalPortions === 12;
        const isQuarterPizza = totalPortions === 3;

        const totalCells = isLargePizza ? 12 : (isQuarterPizza ? 3 : 6);
        const gridCols = isLargePizza ? 'grid-cols-6' : (isQuarterPizza ? 'grid-cols-1' : 'grid-cols-3');
        const widthClass = isLargePizza ? 'w-64' : (isQuarterPizza ? 'w-16' : 'w-32');
        const containerShapeClass = isLargePizza ? 'rounded-full' : (isQuarterPizza ? 'rounded-tl-full rounded-bl-full' : 'rounded-l-full');

        const fillColor = 'bg-orange-500';
        
        const finalCellClasses = Array(totalCells).fill('bg-gray-700/50');
        
        const sortedFlavorKeys = Object.keys(selectedFlavors).sort();
        const filledPortions = sortedFlavorKeys.reduce((sum, key) => sum + selectedFlavors[key], 0);

        if (baseItem.id === 903) { // Special logic for 3-flavor pizza
            const flavorChunks = [[0, 1, 6, 7], [2, 3, 8, 9], [4, 5, 10, 11]];
            sortedFlavorKeys.forEach((flavorId, chunkIndex) => {
                const chunkIndices = flavorChunks[chunkIndex];
                chunkIndices.forEach(cellIndex => {
                    if (cellIndex < totalCells) {
                        finalCellClasses[cellIndex] = fillColor;
                    }
                });
            });
        } else if (isQuarterPizza) {
            if (filledPortions > 0) {
                finalCellClasses.fill(fillColor);
            }
        } else { // Default logic for 2/4 flavors
            const verticalCellOrder12 = [0, 6, 1, 7, 2, 8, 3, 9, 4, 10, 5, 11]; // Fills left-to-right
            const horizontalCellOrder12 = Array.from(Array(12).keys()); // Fills top-to-bottom [0, 1, ..., 11]
            const sequentialCellOrder6 = Array.from(Array(6).keys()); // For 6-slice pizza [0, ..., 5]

            let cellOrder;
            if (isLargePizza) {
                // Apply vertical fill only for 1/2 pizza (6 portions)
                cellOrder = filledPortions === 6 ? verticalCellOrder12 : horizontalCellOrder12;
            } else {
                cellOrder = sequentialCellOrder6;
            }
            
            let currentCellIndex = 0;
            sortedFlavorKeys.forEach((flavorId) => {
              const portions = selectedFlavors[flavorId];
              for (let i = 0; i < portions; i++) {
                if (currentCellIndex < totalCells) {
                  const targetCell = cellOrder[currentCellIndex];
                  finalCellClasses[targetCell] = fillColor;
                  currentCellIndex++;
                }
              }
            });
        }
        
        let description = '';
        if (baseItem.id === 901) { // 4 flavors
            description = `${filledPortions / 3} de 4 sabores seleccionados`;
        } else if (baseItem.id === 903) { // 3 flavors
            description = `${filledPortions / 4} de 3 sabores seleccionados`;
        } else if (baseItem.id === 902) { // 2 flavors
            description = `${filledPortions / 3} de 2 sabores seleccionados`;
        } else if (isQuarterPizza) {
            description = `${filledPortions > 0 ? 1 : 0} de 1 sabor seleccionado`;
        } else {
            description = `${filledPortions} de ${totalPortions} porciones`;
        }

        const getCornerClasses = (index) => {
          if (isLargePizza) { // 6x2 grid for 12 portions
            if (index === 0) return 'rounded-tl-full';
            if (index === 5) return 'rounded-tr-full';
            if (index === 6) return 'rounded-bl-full';
            if (index === 11) return 'rounded-br-full';
          } else if (isQuarterPizza) {
            if (index === 0) return 'rounded-tl-full';
            if (index === 2) return 'rounded-bl-full';
          } else { // 3x2 grid for 6 portions
            if (index === 0) return 'rounded-tl-full';
            if (index === 3) return 'rounded-bl-full';
          }
          return '';
        };

        return (
          <div className="flex flex-col items-center">
            <div className={`${widthClass} bg-black p-1 ${containerShapeClass} overflow-hidden`}>
              <div className={`grid ${gridCols} gap-1`}>
                {finalCellClasses.map((colorClass, i) => (
                  <div
                    key={i}
                    className={`w-full aspect-square ${colorClass} ${getCornerClasses(i)} transition-colors duration-300`}
                  />
                ))}
              </div>
            </div>
            <p className="text-brand-text-light font-semibold mt-3 text-center tabular-nums">
              {description}
            </p>
          </div>
        );
      }

      function MastroBuilderModal({ baseItem, onClose, onConfirm }) {
        if (!baseItem) return null;
        
        const [currentBaseItem, setCurrentBaseItem] = useState(baseItem);
        const [selectedFlavors, setSelectedFlavors] = useState({}); // e.g., { 1: 3, 4: 3 } -> { itemId: portions }

        useEffect(() => {
          // When the modal is opened with a new baseItem, reset everything
          setCurrentBaseItem(baseItem);
          setSelectedFlavors({});
        }, [baseItem]);
        
        const pizzaFlavors = useMemo(() => menuItems.filter(item => item.category === Category.Pizzas && !item.isMastro), []);

        const totalPortions = currentBaseItem.portions;
        const filledPortions = Object.values(selectedFlavors).reduce((sum, p) => sum + p, 0);
        const remainingPortions = totalPortions - filledPortions;
        const isReadyToAdd = filledPortions === totalPortions;
        const hasFlavors = Object.keys(selectedFlavors).length > 0;
        
        const price = useMemo(() => {
            if (!currentBaseItem || !hasFlavors) return 0;
            const flavorIds = Object.keys(selectedFlavors);
            const flavorId = flavorIds[0];

            if (currentBaseItem.portions === 3) {
                // The price is the quarter price of the chosen flavor
                return flavorId ? itemsById[flavorId].quarterPrice : 0;
            }
            if (currentBaseItem.portions === 6) {
                // Price is the highest halfPrice among selected flavors
                return Math.max(...flavorIds.map(id => itemsById[id].halfPrice));
            }
            if (currentBaseItem.portions === 12) {
                // Price is the highest full price among selected flavors
                return Math.max(...flavorIds.map(id => itemsById[id].price));
            }

            return 0; // Fallback
        }, [currentBaseItem, selectedFlavors, hasFlavors]);
        
        const handleSwitchMode = (targetId) => {
          const targetPizza = menuItems.find(item => item.id === targetId);
          if (targetPizza) {
            setCurrentBaseItem(targetPizza);
            setSelectedFlavors({});
          }
        };

        const handleAddFlavor = (item, portions) => {
          if (portions > remainingPortions) return;
          setSelectedFlavors(prev => ({ ...prev, [item.id]: portions }));
        };
        
        const handleRemoveFlavor = (itemId) => {
          setSelectedFlavors(prev => {
            const newFlavors = { ...prev };
            delete newFlavors[itemId];
            return newFlavors;
          });
        };

        const getPortionLabel = (portions, total) => {
            if (currentBaseItem.id === 903) {
                if (portions === 4) return '⅓';
                if (portions === 8) return '⅔';
                if (portions === 12) return 'Completa';
            }
            if (portions === total) return 'Completa';
            if (total === 6) return '½'; // for 3 portions
            if (total === 12) {
                if (portions === 3) return '¼';
                if (portions === 6) return '½';
                if (portions === 9) return '¾';
            }
            return `${portions} porc.`; // Fallback
        };

        const handleConfirmMastroPizza = (pizzaData) => {
            const { baseItem, selectedFlavors, price } = pizzaData;

            const customId = `mastro-${Date.now()}`;
            const description = selectedFlavors
                .map(f => {
                  const portionLabel = getPortionLabel(f.portions, baseItem.portions);
                  return `${f.item.name} (${portionLabel})`;
                })
                .join(' + ');

            const mastroPizzaItem = {
                id: customId,
                name: baseItem.name,
                description: description, // Used for display in the cart on the page
                price: price,
                category: Category.Pizzas,
                // New properties for detailed WhatsApp message
                totalPortions: baseItem.portions,
                flavors: selectedFlavors.map(f => ({ name: f.item.name, portions: f.portions })),
            };
            
            onConfirm(mastroPizzaItem);
        };

        const handleConfirm = () => {
          const finalSelectedFlavors = Object.entries(selectedFlavors).map(([id, portions]) => ({
            item: itemsById[id],
            portions: portions,
          }));

          handleConfirmMastroPizza({
            baseItem: currentBaseItem,
            selectedFlavors: finalSelectedFlavors,
            price: price,
          });
        };

        const getPortionButtons = (item) => {
            let buttons = [];
            if (currentBaseItem.id === 903) { // 12 portions, 3 flavors
                buttons = [
                    { portions: 4, label: '⅓' },
                    { portions: 12, label: 'Completa' },
                ];
            } else if (totalPortions === 12) { // 12 portions, 4 flavors
                buttons = [
                    { portions: 3, label: '¼' },
                    { portions: 6, label: '½' },
                    { portions: 9, label: '¾' },
                    { portions: 12, label: 'Completa' },
                ];
            } else if (totalPortions === 6) {
                buttons = [ 
                    { portions: 3, label: '½' },
                    { portions: 6, label: 'Completa' },
                ];
            } else if (totalPortions === 3) {
                buttons = [ { portions: 3, label: 'Completa' } ];
            }
            return buttons.map(btn => (
              <button
                key={btn.portions}
                onClick={() => handleAddFlavor(item, btn.portions)}
                disabled={btn.portions > remainingPortions}
                className="bg-brand-accent text-white px-3 py-2 text-sm rounded-md font-semibold hover:bg-orange-600 transition-all disabled:bg-gray-600/70 disabled:cursor-not-allowed whitespace-nowrap"
              >
                {totalPortions === 3 ? 'Pedir' : `+ ${btn.label}`}
              </button>
            ));
        };

        return (
          <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center animate-fade-in p-4" onClick={onClose}>
            <div className="bg-brand-card rounded-md shadow-xl w-full max-w-2xl h-[90vh] flex flex-col animate-fade-in-up border border-gray-600" onClick={e => e.stopPropagation()}>
              {/* Header */}
              <div className="p-4 border-b border-gray-700 flex-shrink-0">
                <h2 className="text-2xl font-extralight text-brand-accent font-display">{currentBaseItem.name}</h2>
                <p className="text-brand-text-light font-light">
                  {currentBaseItem.portions === 3 ? 'Elige el sabor para tu pizza.' : 'Elige los sabores para completar tu pizza.'}
                </p>
              </div>
              
              <div className="flex-grow overflow-hidden flex flex-col">
                  {/* Visualizer */}
                  {totalPortions > 0 && (
                    <div className="flex-shrink-0 bg-brand-card/80 backdrop-blur-sm z-10 border-b border-gray-700 py-4 flex justify-center items-center gap-4">
                      <PizzaVisualizer
                        baseItem={currentBaseItem}
                        selectedFlavors={selectedFlavors}
                      />
                      {(baseItem.id === 901 || baseItem.id === 903) && (
                        <div className="flex flex-col space-y-2">
                           {currentBaseItem.id === 901 ? (
                             <button onClick={() => handleSwitchMode(903)} className="bg-brand-teal text-white py-2 px-3 rounded-md font-semibold hover:bg-teal-600 transition-colors text-sm">
                               Elegir 3 Sabores
                             </button>
                           ) : (
                             <button onClick={() => handleSwitchMode(901)} className="bg-brand-teal text-white py-2 px-3 rounded-md font-semibold hover:bg-teal-600 transition-colors text-sm">
                               Elegir 4 Sabores
                             </button>
                           )}
                        </div>
                      )}
                    </div>
                  )}

                  {/* Main Content: Flavor List */}
                  <div className="flex-grow overflow-y-auto p-4 space-y-3 no-scrollbar">
                    {pizzaFlavors.map(flavor => {
                      const selectedPortion = selectedFlavors[flavor.id];
                      const isSelected = !!selectedPortion;

                      return (
                        <div 
                          key={flavor.id} 
                          className={`p-3 rounded-md flex flex-col border transition-all duration-300 ${isSelected ? 'bg-brand-accent/20 border-brand-accent' : 'bg-gray-800 border-gray-700'}`}
                        >
                          <div className="flex flex-col md:flex-row md:justify-between md:items-center">
                            <div className="md:pr-4 mb-3 md:mb-0 text-center md:text-left">
                              <h4 className="font-semibold text-brand-text">{flavor.name}</h4>
                            </div>
                            <div className="flex gap-2 items-center flex-shrink-0 w-full justify-around md:w-auto md:justify-start">
                              {isSelected ? (
                                  <div className="flex items-center justify-between gap-3 animate-fade-in w-full">
                                      <span className="text-lg font-semibold text-brand-accent whitespace-nowrap">
                                          {`Seleccionado: ${getPortionLabel(selectedPortion, totalPortions)}`}
                                      </span>
                                      <button
                                          onClick={() => handleRemoveFlavor(flavor.id)}
                                          className="bg-red-500/20 text-red-400 px-5 py-3 text-base rounded-md font-semibold hover:bg-red-500/40 transition-colors"
                                          aria-label={`Quitar selección de ${flavor.name}`}
                                      >
                                          Eliminar
                                      </button>
                                  </div>
                              ) : (
                                getPortionButtons(flavor)
                              )}
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
              </div>


              {/* Footer */}
              <div className="p-4 border-t border-gray-700 flex-shrink-0 bg-brand-header rounded-b-md">
                  <div className="flex justify-between items-center mb-4 min-h-[2.5rem]">
                    <div>
                      <span className="text-lg font-semibold text-brand-text">Precio Final:</span>
                    </div>
                    {hasFlavors && <span className="text-2xl font-bold text-brand-accent animate-fade-in">{formatPrice(price)}</span>}
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <button onClick={onClose} className="bg-gray-700 text-brand-text py-3 rounded-md font-semibold hover:bg-gray-600 transition-colors">Cancelar</button>
                    <button 
                      onClick={handleConfirm} 
                      disabled={!isReadyToAdd} 
                      className="bg-brand-accent text-white py-3 rounded-md font-semibold hover:bg-orange-600 transition-transform transform hover:scale-105 disabled:bg-gray-500 disabled:cursor-not-allowed disabled:scale-100">
                      Agregar al Carrito
                    </button>
                  </div>
                  {!isReadyToAdd && (
                      <p className="text-xs text-brand-text-light mt-2 text-center">Debes completar las {totalPortions} porciones para agregar al carrito.</p>
                  )}
              </div>
            </div>
          </div>
        );
      }

      function AddToCartModal({ item, onClose, onConfirm }) {
          const [quantity, setQuantity] = useState(1);

          useEffect(() => {
              if (item) {
                  setQuantity(1);
              }
          }, [item]);

          if (!item) return null;

          const handleConfirm = () => {
            onConfirm(item, quantity);
            onClose();
          };

          return (
            <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center animate-fade-in p-4" onClick={onClose}>
              <div className="bg-brand-card rounded-md shadow-xl w-full max-w-sm p-6 animate-fade-in-up border border-gray-600" onClick={e => e.stopPropagation()}>
                <h2 className="text-xl font-extralight text-brand-text mb-2 text-center">Vas a agregar al carrito</h2>
                <p className="text-2xl font-extralight font-display text-brand-accent text-center mb-4">{item.name}</p>

                <div className="flex items-center justify-center space-x-4 my-6">
                    <button onClick={() => setQuantity(q => Math.max(1, q - 1))} className="bg-gray-700 rounded-md p-3 text-brand-accent hover:bg-gray-600 transition-colors"><MinusIcon /></button>
                    <span className="text-2xl font-bold w-10 text-center tabular-nums">{quantity}</span>
                    <button onClick={() => setQuantity(q => q + 1)} className="bg-gray-700 rounded-md p-3 text-brand-accent hover:bg-gray-600 transition-colors"><PlusIcon /></button>
                </div>
                
                <div className="flex justify-between items-center mb-6">
                  <span className="text-lg font-semibold text-brand-text">Total:</span>
                  <span className="text-2xl font-bold text-brand-accent">{formatPrice(item.price * quantity)}</span>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <button 
                      onClick={onClose} 
                      className="w-full bg-gray-700 text-brand-text py-3 rounded-md font-semibold hover:bg-gray-600 transition-colors"
                      aria-label="Cancelar y volver al menú"
                  >
                    Atrás
                  </button>
                  <button 
                      onClick={handleConfirm} 
                      className="w-full bg-brand-accent text-white py-3 rounded-md font-semibold hover:bg-orange-600 transition-transform transform hover:scale-105"
                      aria-label={`Confirmar y agregar ${quantity} ${item.name} al carrito`}
                  >
                    Agregar
                  </button>
                </div>
              </div>
            </div>
          );
      }
      
      function HalfPizzaModal({ item, onClose, onConfirm }) {
          if (!item) return null;

          const handleConfirm = () => {
              onConfirm(item);
          };

          return (
              <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center animate-fade-in p-4" onClick={onClose}>
                  <div className="bg-brand-card rounded-md shadow-xl w-full max-w-sm p-6 animate-fade-in-up border border-gray-600" onClick={e => e.stopPropagation()}>
                      <h2 className="text-xl font-extralight text-brand-text mb-2 text-center">Vas a agregar media pizza</h2>
                      <p className="text-2xl font-extralight font-display text-brand-accent text-center mb-1">de {item.name.replace(/^Pizza (de )?/, '')}</p>
                      <p className="text-2xl font-bold text-brand-accent text-center mb-6">{formatPrice(item.halfPrice)}</p>

                      <div className="grid grid-cols-2 gap-4 mt-6">
                          <button 
                              onClick={onClose} 
                              className="w-full bg-gray-700 text-brand-text py-3 rounded-md font-semibold hover:bg-gray-600 transition-colors"
                              aria-label="Cancelar y volver al menú"
                          >
                            Atrás
                          </button>
                          <button 
                              onClick={handleConfirm} 
                              className="w-full bg-brand-accent text-white py-3 rounded-md font-semibold hover:bg-orange-600 transition-transform transform hover:scale-105"
                              aria-label={`Confirmar y agregar media ${item.name}`}
                          >
                            Agregar
                          </button>
                      </div>
                  </div>
              </div>
          );
      }

      function QuarterPizzaModal({ item, onClose, onConfirm }) {
          if (!item) return null;

          const handleConfirm = () => {
              onConfirm(item);
          };

          return (
              <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center animate-fade-in p-4" onClick={onClose}>
                  <div className="bg-brand-card rounded-md shadow-xl w-full max-w-sm p-6 animate-fade-in-up border border-gray-600" onClick={e => e.stopPropagation()}>
                      <h2 className="text-xl font-extralight text-brand-text mb-2 text-center">Vas a agregar un cuarto de pizza</h2>
                      <p className="text-2xl font-extralight font-display text-brand-accent text-center mb-1">de {item.name.replace(/^Pizza (de )?/, '')}</p>
                      <p className="text-2xl font-bold text-brand-accent text-center mb-6">{formatPrice(item.quarterPrice)}</p>

                      <div className="grid grid-cols-2 gap-4 mt-6">
                          <button 
                              onClick={onClose} 
                              className="w-full bg-gray-700 text-brand-text py-3 rounded-md font-semibold hover:bg-gray-600 transition-colors"
                              aria-label="Cancelar y volver al menú"
                          >
                            Atrás
                          </button>
                          <button 
                              onClick={handleConfirm} 
                              className="w-full bg-brand-accent text-white py-3 rounded-md font-semibold hover:bg-orange-600 transition-transform transform hover:scale-105"
                              aria-label={`Confirmar y agregar un cuarto de ${item.name}`}
                          >
                            Agregar
                          </button>
                      </div>
                  </div>
              </div>
          );
      }

      function ItemDetailModal({ item, onClose, onAddToCart }) {
        const [quantity, setQuantity] = useState(1);

        useEffect(() => {
            if (item) {
                setQuantity(1);
            }
        }, [item]);

        if (!item) return null;

        const handleAddToCart = () => {
          onAddToCart(item, quantity);
          onClose();
        };

        return (
          <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center animate-fade-in" onClick={onClose}>
            <div className="bg-brand-card rounded-md shadow-xl w-11/12 max-w-lg max-h-[90vh] overflow-y-auto animate-fade-in-up relative border border-gray-600" onClick={e => e.stopPropagation()}>
              <button onClick={onClose} className="absolute top-4 left-4 z-10 bg-gray-900/80 backdrop-blur-sm rounded-md p-2 text-brand-text hover:bg-gray-800/90 transition-transform transform hover:scale-110" aria-label="Volver al menú">
                  <ChevronLeftIcon />
              </button>
              {item.imageUrls && item.imageUrls.length > 0 && (
                <img src={item.imageUrls[0]} alt={item.name} className="w-full h-64 object-cover" />
              )}
              <div className="p-6">
                <h2 className="text-3xl font-extralight font-display text-brand-text mb-2">{item.name}</h2>
                <p className="text-brand-text-light mb-4 font-light">{item.description}</p>
                {item.ingredients && item.ingredients.length > 0 && (
                  <div className="mb-4">
                    <h4 className="font-extralight text-brand-text">Ingredientes:</h4>
                    <p className="text-brand-text-light text-sm font-light">{item.ingredients.join(', ')}</p>
                  </div>
                )}
                <div className="flex items-center justify-between mb-6">
                    <span className="text-2xl font-bold text-brand-accent">{formatPrice(item.price * quantity)}</span>
                    <div className="flex items-center space-x-3 bg-gray-800 rounded-md p-1">
                        <button onClick={() => setQuantity(q => Math.max(1, q - 1))} className="bg-gray-700 hover:bg-gray-600 rounded-md p-2 text-brand-accent transition-colors"><MinusIcon /></button>
                        <span className="text-xl font-bold w-8 text-center">{quantity}</span>
                        <button onClick={() => setQuantity(q => q + 1)} className="bg-gray-700 hover:bg-gray-600 rounded-md p-2 text-brand-accent transition-colors"><PlusIcon /></button>
                    </div>
                </div>
                <button onClick={handleAddToCart} className="w-full bg-brand-accent text-white py-3 rounded-md font-semibold text-lg hover:bg-orange-600 transition-all transform hover:scale-105">
                  Agregar al Carrito
                </button>
              </div>
            </div>
          </div>
        );
      }

      function MenuPage({ onSelectItem, onAdd, selectedCategory, onAddHalf, onAddQuarter }) {
        const renderAllItems = () => {
            const categoryOrder = [Category.Pizzas, Category.Hamburguesas, Category.Sanguches];
            
            return (
                <div className="p-4 space-y-8">
                    {categoryOrder.map(category => {
                        const itemsInCategory = menuItems.filter(item => 
                            item.category === category && (category !== Category.Pizzas || item.isMastro || item.isPromo) && item.id !== 903
                        );
                        if (itemsInCategory.length === 0) return null;
                        
                        return (
                            <section key={category} aria-labelledby={`category-title-${category}`}>
                                <h2 id={`category-title-${category}`} className="font-display text-2xl font-extralight text-brand-accent pb-2 mb-6 border-b-2 border-brand-accent/30">{category}</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {itemsInCategory.map(item => (
                                        <MenuItemCard key={item.id} item={item} onSelect={onSelectItem} onAdd={onAdd} onAddHalf={onAddHalf} onAddQuarter={onAddQuarter} />
                                    ))}
                                </div>
                            </section>
                        );
                    })}
                </div>
            );
        };

        const renderFilteredItems = () => {
            const filteredItems = menuItems.filter(item => 
                item.category === selectedCategory && (selectedCategory !== Category.Pizzas || item.isMastro || item.isPromo) && item.id !== 903
            );
            return (
                <div className="p-4 grid grid-cols-1 md:grid-cols-2 gap-6">
                    {filteredItems.map(item => (
                        <MenuItemCard key={item.id} item={item} onSelect={onSelectItem} onAdd={onAdd} onAddHalf={onAddHalf} onAddQuarter={onAddQuarter} />
                    ))}
                </div>
            );
        };

        return (
            <div>
                {selectedCategory === Category.Todos ? renderAllItems() : renderFilteredItems()}
            </div>
        );
      }
      
      function AboutPage({onBack}) {
        const CONSULTA_MESSAGE = "Hola Mastropizzas Pergamino, quiero hacer una consulta";
        const WHATSAPP_CONSULTA_URL = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(CONSULTA_MESSAGE)}`;
        const PHONE_NUMBER_URL = `tel:+${WHATSAPP_NUMBER}`;

        return (
           <div className="p-4 md:p-6 animate-fade-in-up">
                <button onClick={onBack} className="flex items-center text-brand-accent font-semibold mb-4 lg:hidden">
                    <ChevronLeftIcon /> Volver al Menú
                </button>
                <div className="bg-brand-card p-6 rounded-md border border-gray-700">
                    <h2 className="text-3xl font-extralight font-display text-brand-text mb-4">Sobre Nosotros</h2>
                    <p className="text-brand-text-light mb-4 font-light">
                        Bienvenidos a <strong>MastroPizza</strong>, tu rincón favorito en Pergamino para disfrutar de la mejor comida casera. Desde 2005, nos dedicamos a preparar pizzas, hamburguesas y empanadas con los ingredientes más frescos y todo el amor que nos caracteriza.
                    </p>
                    <p className="text-brand-text-light mb-4 font-light">
                        Nuestro secreto es simple: recetas familiares, productos de calidad y un equipo apasionado por la buena cocina. ¡Gracias por elegirnos!
                    </p>
                    <div className="border-t border-gray-700 my-4"></div>
                    <h3 className="text-xl font-extralight text-brand-text mb-2">Horarios</h3>
                    <p className="text-brand-text-light font-light mb-4">Martes a Domingos: 19:00hs a 23:30hs</p>

                    <div className="border-t border-gray-700 my-4"></div>
                    <h3 className="text-xl font-extralight text-brand-text mb-2">Ubicación</h3>
                    <p className="text-brand-text-light font-light flex items-center mb-3">
                       <MapPinIcon /> Alberti 369 entre Av. de Mayo y Pinto
                    </p>
                    <a 
                        href="https://maps.app.goo.gl/P26aFEKVc7eA6wa57" 
                        target="_blank" 
                        rel="noopener noreferrer"
                        className="inline-flex items-center justify-center w-full bg-gray-700 text-brand-text py-3 rounded-md font-semibold hover:bg-gray-600 transition-colors"
                    >
                        <MapIcon /> Ver en Google Maps
                    </a>
                    
                    <div className="border-t border-gray-700 my-4"></div>
                    <h3 className="text-xl font-extralight text-brand-text mb-3">Contacto</h3>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <a 
                            href={WHATSAPP_CONSULTA_URL}
                            target="_blank" 
                            rel="noopener noreferrer"
                            className="inline-flex items-center justify-center w-full bg-brand-teal text-white py-3 rounded-md font-semibold hover:bg-teal-700 transition-colors"
                        >
                           <WhatsAppIcon /> Habla con nosotros
                        </a>
                        <a 
                            href={PHONE_NUMBER_URL}
                            className="inline-flex items-center justify-center w-full bg-gray-700 text-brand-text py-3 rounded-md font-semibold hover:bg-gray-600 transition-colors"
                        >
                            <PhoneIcon /> Llamar
                        </a>
                    </div>
                </div>
           </div>
        );
      }
      
      function CheckoutView({ cart, updateCart, onBack, clearCart, isDesktop = false, customItems = {} }) {
        const [deliveryMethod, setDeliveryMethod] = useState('delivery'); // 'delivery' or 'pickup'
        const [address, setAddress] = useState('');
        const [customerName, setCustomerName] = useState('');
        const [phone, setPhone] = useState('');

        const allItems = useMemo(() => ({ ...itemsById, ...customItems }), [customItems]);

        const cartItems = useMemo(() => {
            return Object.entries(cart)
                .map(([id, quantity]) => {
                    const item = allItems[id];
                    // Ensure item exists before spreading, convert id to string for startsWith
                    return item ? { ...item, id: String(item.id), quantity } : null;
                })
                .filter(item => item && item.id);
        }, [cart, allItems]);

        const subtotal = useMemo(() => cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0), [cartItems]);
        const total = useMemo(() => subtotal + (deliveryMethod === 'delivery' ? SHIPPING_COST : 0), [subtotal, deliveryMethod]);
        
        const handleConfirmOrder = () => {
          if (deliveryMethod === 'delivery' && !address.trim()) {
            alert('Por favor, ingresa tu dirección para el envío.');
            return;
          }
           if (!customerName.trim()) {
            alert('Por favor, ingresa tu nombre.');
            return;
          }
          if (!phone.trim()) {
            alert('Por favor, ingresa tu número de teléfono.');
            return;
          }

          const orderLines = [];
          
          cartItems.forEach((item) => {
              // MastroPizza (quantity is always 1)
              if (item.id.startsWith('mastro-')) {
                  let size;
                  if (item.totalPortions === 12) size = '1';
                  else if (item.totalPortions === 6) size = '1/2';
                  else if (item.totalPortions === 3) size = '1/4';

                  const flavorDetails = item.flavors.map(flavor => {
                      const flavorName = flavor.name.replace(/^Pizza (de )?/, '');
                      // For single flavor pizzas (like the 3-portion one), just list the name
                      if (item.flavors.length === 1 && flavor.portions === item.totalPortions) {
                          return flavorName;
                      }

                      // For multi-flavor items, show the flavor name and its fraction of a full 12-slice pizza.
                      let fractionStr = '';
                      if (flavor.portions === 3) fractionStr = '1/4';
                      else if (flavor.portions === 6) fractionStr = '1/2';
                      else if (flavor.portions === 9) fractionStr = '3/4';
                      
                      return `${flavorName} ${fractionStr}`.trim();
                  }).join(' - ');
                  
                  orderLines.push(`*${size}- ${flavorDetails}*`);
              } 
              // Half Pizza (quantity is always 1)
              else if (item.isHalf || String(item.id).endsWith('-half')) {
                  const baseName = item.name.replace('Media ', '');
                  orderLines.push(`*1/2- ${baseName} – ${formatPrice(item.price)}*`);
              }
              // Quarter Pizza (quantity is always 1)
              else if (item.isQuarter || String(item.id).endsWith('-quarter')) {
                  const baseName = item.name.replace('Cuarto ', '');
                  orderLines.push(`*1/4- ${baseName} – ${formatPrice(item.price)}*`);
              }
              // Standard Full Pizza
              else if (item.category === Category.Pizzas) {
                  for (let i = 0; i < item.quantity; i++) {
                      orderLines.push(`*1- ${item.name} – ${formatPrice(item.price)}*`);
                  }
              }
              // Other items
              else {
                  for (let i = 0; i < item.quantity; i++) {
                      orderLines.push(`*${item.name} – ${formatPrice(item.price)}*`);
                  }
              }
          });

          const orderDetails = orderLines.join('\n \n');
          
          let message = `*¡Nuevo Pedido desde la App!* 🍔🍕\n\n`;
          message += `*Cliente:* ${customerName}\n`;
          message += `*Teléfono:* ${phone}\n\n`;
          message += `*Resumen del Pedido:*\n${orderDetails}\n\n`;
          message += `*Subtotal:* ${formatPrice(subtotal)}\n`;

          if (deliveryMethod === 'delivery') {
            message += `*Método de Entrega:* Enviar a domicilio\n`;
            message += `*Dirección:* ${address}\n`;
            message += `*Costo de Envío:* ${formatPrice(SHIPPING_COST)}\n`;
          } else {
            message += `*Método de Entrega:* Retirar del local\n`;
          }
          
          message += `\n*TOTAL A PAGAR: ${formatPrice(total)}*`;

          const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
          window.open(whatsappUrl, '_blank');

          clearCart();
          setAddress('');
          setCustomerName('');
          setPhone('');
          setDeliveryMethod('delivery');
        };


        if (cartItems.length === 0) {
            return (
                <div className={`p-6 text-center animate-fade-in-up ${isDesktop ? 'bg-brand-card rounded-md border border-gray-700' : ''}`}>
                    <h2 className="text-2xl font-extralight text-brand-text mb-4 font-display">Tu carrito está vacío</h2>
                    <p className="text-brand-text-light mb-6 font-light">Agrega productos del menú para empezar.</p>
                    {!isDesktop && (
                        <button onClick={onBack} className="bg-brand-accent text-white px-6 py-3 rounded-md font-semibold hover:bg-orange-600 transition-transform transform hover:scale-105">
                            Ver Menú
                        </button>
                    )}
                </div>
            )
        }
        
        const isFractionalPizza = (item) => item.isHalf || String(item.id).endsWith('-half') || item.isQuarter || String(item.id).endsWith('-quarter') || item.id.startsWith('mastro-');

        // --- Desktop View ---
        if (isDesktop) {
            return (
                <div className="flex flex-col bg-brand-card rounded-md border border-gray-700 animate-fade-in-up max-h-[calc(100vh-7.5rem)] h-full">
                    {/* Fixed Header */}
                    <div className="p-4 flex-shrink-0 border-b border-gray-700">
                        <h2 className="text-3xl font-extralight font-display text-brand-text">Finalizar Compra</h2>
                    </div>

                    {/* Scrollable Order List */}
                    <div className="flex-grow overflow-y-auto p-4 no-scrollbar">
                        <h3 className="font-extralight text-lg mb-4">Tu Pedido</h3>
                        <div className="space-y-3">
                            {cartItems.map(item => (
                                <div key={item.id} className="flex items-center justify-between py-2 border-b border-gray-700/50 last:border-b-0 gap-2 bg-gray-800/50 p-3 rounded-md">
                                    <div className="flex-grow">
                                        <p className="font-semibold text-sm">{item.name}</p>
                                        {(item.id.startsWith('mastro-') || item.isHalf || item.isQuarter) && item.description && <p className="text-xs text-brand-text-light font-light mt-1">{item.description}</p>}
                                        <div className="flex items-center space-x-3 mt-2">
                                            <div className="flex items-center space-x-1 rounded-md bg-gray-900 p-0.5">
                                                <button onClick={() => updateCart(item.id, item.quantity - 1)} className="bg-gray-700 hover:bg-gray-600 rounded p-1 text-brand-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled={isFractionalPizza(item)} aria-label={`Disminuir cantidad de ${item.name}`}>
                                                    <MinusIcon />
                                                </button>
                                                <span className="font-bold w-5 text-center text-sm" aria-live="polite">{item.quantity}</span>
                                                <button onClick={() => updateCart(item.id, item.quantity + 1)} className="bg-gray-700 hover:bg-gray-600 rounded p-1 text-brand-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled={isFractionalPizza(item)} aria-label={`Aumentar cantidad de ${item.name}`}>
                                                    <PlusIcon />
                                                </button>
                                            </div>
                                            <p className="text-xs text-brand-text-light">x {formatPrice(item.price)}</p>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-end space-y-1">
                                    <span className="font-bold text-brand-accent text-base text-right">{formatPrice(item.price * item.quantity)}</span>
                                    <button onClick={() => updateCart(item.id, 0)} className="text-red-500 hover:text-red-700 p-1" aria-label={`Eliminar ${item.name} del carrito`}>
                                        <TrashIcon />
                                    </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Fixed Footer */}
                    <div className="p-4 flex-shrink-0 border-t border-gray-700 space-y-4">
                        <div>
                            <h3 className="font-extralight text-lg mb-3">Tu Información</h3>
                            <div className="space-y-2">
                                <input type="text" value={customerName} onChange={(e) => setCustomerName(e.target.value)} placeholder="Tu nombre" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-sm focus:ring-2 focus:ring-brand-accent focus:border-brand-accent focus:outline-none placeholder:text-gray-500" aria-label="Nombre del cliente" />
                                <input type="tel" value={phone} onChange={(e) => setPhone(e.target.value)} placeholder="Tu número de teléfono" className="w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-sm focus:ring-2 focus:ring-brand-accent focus:border-brand-accent focus:outline-none placeholder:text-gray-500" aria-label="Número de teléfono del cliente" />
                            </div>
                            <h3 className="font-extralight text-lg mb-2 mt-3">Método de Entrega</h3>
                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => setDeliveryMethod('delivery')} className={`p-2 rounded-md border-2 text-sm font-semibold transition-colors ${deliveryMethod === 'delivery' ? 'bg-brand-accent/20 border-brand-accent' : 'bg-gray-700 border-gray-600'}`}>
                                    Enviar a domicilio
                                </button>
                                <button onClick={() => setDeliveryMethod('pickup')} className={`p-2 rounded-md border-2 text-sm font-semibold transition-colors ${deliveryMethod === 'pickup' ? 'bg-brand-accent/20 border-brand-accent' : 'bg-gray-700 border-gray-600'}`}>
                                    Retirar del local
                                </button>
                            </div>
                            {deliveryMethod === 'delivery' && (
                                <input type="text" value={address} onChange={(e) => setAddress(e.target.value)} placeholder="Tu dirección completa" className="w-full p-2 mt-2 bg-gray-700 border border-gray-600 rounded-md text-sm focus:ring-2 focus:ring-brand-accent focus:border-brand-accent focus:outline-none placeholder:text-gray-500" aria-label="Dirección de envío"/>
                            )}
                        </div>
                        
                        <div>
                            <h3 className="font-extralight text-lg mb-2">Resumen de Costos</h3>
                            <div className="space-y-1 text-sm text-brand-text-light">
                                <div className="flex justify-between"><span>Subtotal</span><span className="font-semibold text-brand-text">{formatPrice(subtotal)}</span></div>
                                {deliveryMethod === 'delivery' && (
                                    <div className="flex justify-between"><span>Envío</span><span className="font-semibold text-brand-text">{formatPrice(SHIPPING_COST)}</span></div>
                                )}
                                <div className="flex justify-between text-lg font-bold text-brand-text pt-1 border-t border-gray-600"><span>Total</span><span>{formatPrice(total)}</span></div>
                            </div>
                        </div>

                        <button onClick={handleConfirmOrder} className="w-full bg-brand-accent text-white py-3 rounded-md font-bold text-lg flex items-center justify-center hover:bg-orange-600 transition-all transform hover:scale-105 shadow-lg shadow-orange-500/30">
                            <WhatsAppIcon /> Hacer pedido
                        </button>
                    </div>
                </div>
            );
        }

        // --- Mobile View ---
        return (
          <div className={'max-w-md mx-auto p-4 animate-fade-in-up'}>
              <button onClick={onBack} className="flex items-center text-brand-accent font-semibold mb-4">
                  <ChevronLeftIcon /> Volver al Menú
              </button>
              <h2 className="text-3xl font-extralight font-display text-brand-text mb-6">Finalizar Compra</h2>

              <div className="bg-brand-card p-4 rounded-md border border-gray-700 mb-6">
                <h3 className="font-extralight text-lg mb-4">Tu Pedido</h3>
                {cartItems.map(item => (
                    <div key={item.id} className="flex items-center justify-between py-3 border-b border-gray-700 last:border-b-0 gap-2">
                        <div className="flex-grow">
                            <p className="font-semibold">{item.name}</p>
                            {(item.id.startsWith('mastro-') || item.isHalf || item.isQuarter) && item.description && <p className="text-sm text-brand-text-light font-light">{item.description}</p>}
                            <div className="flex items-center space-x-4 mt-2">
                                <div className="flex items-center space-x-2 rounded-md bg-gray-800 p-1">
                                    <button onClick={() => updateCart(item.id, item.quantity - 1)} className="bg-gray-700 hover:bg-gray-600 rounded-md p-1 text-brand-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled={isFractionalPizza(item)} aria-label={`Disminuir cantidad de ${item.name}`}>
                                        <MinusIcon />
                                    </button>
                                    <span className="font-bold w-6 text-center" aria-live="polite">{item.quantity}</span>
                                    <button onClick={() => updateCart(item.id, item.quantity + 1)} className="bg-gray-700 hover:bg-gray-600 rounded-md p-1 text-brand-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled={isFractionalPizza(item)} aria-label={`Aumentar cantidad de ${item.name}`}>
                                        <PlusIcon />
                                    </button>
                                </div>
                                <p className="text-sm text-brand-text-light">x {formatPrice(item.price)}</p>
                            </div>
                        </div>
                        <div className="flex items-center space-x-3">
                           <span className="font-bold text-brand-accent text-lg">{formatPrice(item.price * item.quantity)}</span>
                           <button onClick={() => updateCart(item.id, 0)} className="text-red-500 hover:text-red-700 p-2" aria-label={`Eliminar ${item.name} del carrito`}>
                             <TrashIcon />
                           </button>
                        </div>
                    </div>
                ))}
              </div>

              <div className="bg-brand-card p-4 rounded-md border border-gray-700 mb-6">
                  <h3 className="font-extralight text-lg mb-4">Tu Información</h3>
                  <input type="text" value={customerName} onChange={(e) => setCustomerName(e.target.value)} placeholder="Tu nombre" className="w-full p-3 bg-gray-700 border border-gray-600 rounded-md mb-4 focus:ring-2 focus:ring-brand-accent focus:border-brand-accent focus:outline-none placeholder:text-gray-500" aria-label="Nombre del cliente"/>
                  <input type="tel" value={phone} onChange={(e) => setPhone(e.target.value)} placeholder="Tu número de teléfono" className="w-full p-3 bg-gray-700 border border-gray-600 rounded-md mb-4 focus:ring-2 focus:ring-brand-accent focus:border-brand-accent focus:outline-none placeholder:text-gray-500" aria-label="Número de teléfono del cliente"/>
                  <h3 className="font-extralight text-lg mb-2">Método de Entrega</h3>
                  <div className="grid grid-cols-2 gap-4 mb-4">
                      <button onClick={() => setDeliveryMethod('delivery')} className={`p-3 rounded-md border-2 font-semibold transition-colors ${deliveryMethod === 'delivery' ? 'bg-brand-accent/20 border-brand-accent' : 'bg-gray-700 border-gray-600'}`}>
                          Enviar a domicilio
                      </button>
                      <button onClick={() => setDeliveryMethod('pickup')} className={`p-3 rounded-md border-2 font-semibold transition-colors ${deliveryMethod === 'pickup' ? 'bg-brand-accent/20 border-brand-accent' : 'bg-gray-700 border-gray-600'}`}>
                          Retirar del local
                      </button>
                  </div>
                  {deliveryMethod === 'delivery' && (
                      <input type="text" value={address} onChange={(e) => setAddress(e.target.value)} placeholder="Tu dirección completa" className="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-brand-accent focus:border-brand-accent focus:outline-none placeholder:text-gray-500" aria-label="Dirección de envío"/>
                  )}
              </div>

              <div className="bg-brand-card p-4 rounded-md border border-gray-700 mb-6">
                  <h3 className="font-extralight text-lg mb-4">Resumen de Costos</h3>
                  <div className="space-y-2 text-brand-text-light">
                      <div className="flex justify-between"><span>Subtotal</span><span className="font-semibold text-brand-text">{formatPrice(subtotal)}</span></div>
                      {deliveryMethod === 'delivery' && (
                        <div className="flex justify-between"><span>Envío</span><span className="font-semibold text-brand-text">{formatPrice(SHIPPING_COST)}</span></div>
                      )}
                      <div className="flex justify-between text-xl font-bold text-brand-text pt-2 border-t border-gray-700"><span>Total</span><span>{formatPrice(total)}</span></div>
                  </div>
              </div>

              <button onClick={handleConfirmOrder} className="w-full bg-brand-accent text-white py-4 rounded-md font-bold text-lg flex items-center justify-center hover:bg-orange-600 transition-all transform hover:scale-105 shadow-lg shadow-orange-500/30">
                <WhatsAppIcon /> Hacer pedido
              </button>
          </div>
        );
      }

      function BottomNav({ view, setView, cartCount }) {
        const navItems = [
          { id: 'menu', label: 'Menú', icon: <GridIcon /> },
          { id: 'about', label: 'Nosotros', icon: <InfoIcon /> },
          { id: 'checkout', label: 'Carrito', icon: <CartIcon count={cartCount} /> },
        ];

        return (
          <nav className="fixed bottom-0 left-0 right-0 bg-brand-card border-t border-gray-700 z-30 lg:hidden">
            <div className="flex justify-around max-w-md mx-auto">
              {navItems.map(({ id, label, icon }) => (
                <button
                  key={id}
                  onClick={() => setView(id)}
                  className={`flex flex-col items-center justify-center w-full pt-2 pb-1 transition-colors duration-200 ${
                    view === id ? 'text-brand-accent' : 'text-brand-text-light hover:text-brand-accent'
                  }`}
                  aria-label={label}
                >
                  {icon}
                  <span className="text-xs font-medium">{label}</span>
                </button>
              ))}
            </div>
          </nav>
        );
      }

      // --- APP ---
      function App() {
        const [view, setView] = useState('menu'); // 'menu', 'about', 'checkout'
        const [cart, setCart] = useState({}); // { itemId: quantity }
        const [customItems, setCustomItems] = useState({}); // For MastroPizzas and HalfPizzas
        const [selectedItem, setSelectedItem] = useState(null);
        const [itemToQuickAdd, setItemToQuickAdd] = useState(null);
        const [halfPizzaToAdd, setHalfPizzaToAdd] = useState(null);
        const [quarterPizzaToAdd, setQuarterPizzaToAdd] = useState(null);
        const [selectedCategory, setSelectedCategory] = useState(Category.Todos);
        const [mastroBuilderState, setMastroBuilderState] = useState({
          isOpen: false,
          baseItem: null,
        });

        useEffect(() => {
          try {
            const savedCart = localStorage.getItem('mastroPizzaCart');
            const savedCustomItems = localStorage.getItem('mastroPizzaCustomItems');
            if (savedCart) setCart(JSON.parse(savedCart));
            if (savedCustomItems) setCustomItems(JSON.parse(savedCustomItems));
          } catch (error) {
            console.error("Failed to load data from localStorage:", error);
            setCart({});
            setCustomItems({});
          }
        }, []);

        useEffect(() => {
            try {
                localStorage.setItem('mastroPizzaCart', JSON.stringify(cart));
                localStorage.setItem('mastroPizzaCustomItems', JSON.stringify(customItems));
            } catch (error) {
                console.error("Failed to save data to localStorage:", error);
            }
        }, [cart, customItems]);
        
        const handleSetView = (newView) => {
          setView(newView);
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const updateCart = useCallback((itemId, quantity) => {
          setCart(prevCart => {
            const newCart = { ...prevCart };
            if (quantity <= 0) {
              delete newCart[itemId];
              // Also remove from custom items if it exists there
              if (String(itemId).startsWith('mastro-') || String(itemId).endsWith('-half') || String(itemId).endsWith('-quarter')) {
                  setCustomItems(prevCustom => {
                      const newCustom = {...prevCustom};
                      delete newCustom[itemId];
                      return newCustom;
                  });
              }
            } else {
              newCart[itemId] = quantity;
            }
            return newCart;
          });
        }, []);

        const addToCart = useCallback((item, quantity) => {
            const itemId = item.id;
            if (item.isHalf || item.isQuarter || String(item.id).startsWith('mastro-')) {
                setCustomItems(prev => ({...prev, [itemId]: item}));
            }
            
            setCart(prevCart => ({
              ...prevCart,
              [itemId]: (prevCart[itemId] || 0) + quantity,
            }));
        }, []);
        
        const clearCart = useCallback(() => {
          setCart({});
          setCustomItems({});
        }, []);

        const openMastroBuilder = (mastroItem) => {
            setMastroBuilderState({
                isOpen: true,
                baseItem: mastroItem,
            });
        };
        
        const closeMastroBuilder = () => {
            setMastroBuilderState({ isOpen: false, baseItem: null });
        };
        
        const handleAddItemClick = (item) => {
          if (item.isMastro) {
            openMastroBuilder(item);
          } else {
            setItemToQuickAdd(item);
          }
        };

        const handleHalfPizzaClick = (item) => {
            const halfPizzaId = `${item.id}-half`;
            if (cart[halfPizzaId]) {
                alert('Ya tienes media pizza de este sabor en tu carrito. Solo se permite una por sabor.');
                return;
            }
            setHalfPizzaToAdd(item);
        };
        
        const handleQuarterPizzaClick = (item) => {
            const quarterPizzaId = `${item.id}-quarter`;
            if (cart[quarterPizzaId]) {
                alert('Ya tienes un cuarto de pizza de este sabor en tu carrito. Solo se permite uno por sabor.');
                return;
            }
            setQuarterPizzaToAdd(item);
        };

        const handleConfirmAddHalfPizza = (originalItem) => {
            const halfPizzaItem = {
                ...originalItem,
                id: `${originalItem.id}-half`,
                name: `Media de ${originalItem.name.replace(/^Pizza (de )?/, '')}`,
                price: originalItem.halfPrice,
                description: `Media pizza de ${originalItem.name.replace(/^Pizza (de )?/, '').toLowerCase()}.`,
                isHalf: true,
            };
            delete halfPizzaItem.halfPrice;
            delete halfPizzaItem.quarterPrice;
            
            addToCart(halfPizzaItem, 1);
            setHalfPizzaToAdd(null);
        };

        const handleConfirmAddQuarterPizza = (originalItem) => {
            const quarterPizzaItem = {
                ...originalItem,
                id: `${originalItem.id}-quarter`,
                name: `Cuarto de ${originalItem.name.replace(/^Pizza (de )?/, '')}`,
                price: originalItem.quarterPrice,
                description: `Un cuarto de pizza de ${originalItem.name.replace(/^Pizza (de )?/, '').toLowerCase()}.`,
                isQuarter: true,
            };
            delete quarterPizzaItem.halfPrice;
            delete quarterPizzaItem.quarterPrice;

            addToCart(quarterPizzaItem, 1);
            setQuarterPizzaToAdd(null);
        };

        const handleConfirmMastroPizza = (mastroPizzaItem) => {
            addToCart(mastroPizzaItem, 1);
            closeMastroBuilder();
        };


        const cartCount = useMemo(() => Object.values(cart).reduce((sum, q) => sum + q, 0), [cart]);

        return (
          <div className="min-h-screen">
            <Header setView={handleSetView} />
            
            <div className="max-w-7xl mx-auto lg:grid lg:grid-cols-12 lg:gap-x-8 lg:px-4">
              <div className="lg:col-span-7 xl:col-span-8">
                {/* Main content: Menu or About page */}
                <div className={`${view === 'checkout' ? 'hidden' : 'block'} lg:block`}>
                   {view !== 'about' && <CategoryNav selectedCategory={selectedCategory} setSelectedCategory={setSelectedCategory} />}
                   
                   <main className="pb-24 lg:pb-12">
                     {view === 'about' ? (
                       <AboutPage onBack={() => handleSetView('menu')} />
                     ) : (
                       <MenuPage 
                         onSelectItem={setSelectedItem} 
                         onAdd={handleAddItemClick}
                         onAddHalf={handleHalfPizzaClick}
                         onAddQuarter={handleQuarterPizzaClick}
                         selectedCategory={selectedCategory}
                       />
                     )}
                   </main>
                </div>
                
                {/* Mobile-only Fullscreen Checkout */}
                {view === 'checkout' && (
                  <div className="lg:hidden pb-24">
                    <CheckoutView
                      cart={cart}
                      updateCart={updateCart}
                      onBack={() => handleSetView('menu')}
                      clearCart={clearCart}
                      isDesktop={false}
                      customItems={customItems}
                    />
                  </div>
                )}
              </div>
              
              {/* Desktop Sidebar */}
              <aside className="hidden lg:block lg:col-span-5 xl:col-span-4 py-6 lg:pr-4">
                <div className="sticky top-[calc(4.5rem+1.5rem)]">
                  <CheckoutView
                    cart={cart}
                    updateCart={updateCart}
                    onBack={() => {}} // No-op for desktop
                    clearCart={clearCart}
                    isDesktop={true}
                    customItems={customItems}
                  />
                </div>
              </aside>
            </div>

            {/* Modals are global */}
            <ItemDetailModal item={selectedItem} onClose={() => setSelectedItem(null)} onAddToCart={addToCart} />
            <AddToCartModal item={itemToQuickAdd} onClose={() => setItemToQuickAdd(null)} onConfirm={addToCart} />
            <HalfPizzaModal 
              item={halfPizzaToAdd} 
              onClose={() => setHalfPizzaToAdd(null)} 
              onConfirm={handleConfirmAddHalfPizza} 
            />
            <QuarterPizzaModal
              item={quarterPizzaToAdd}
              onClose={() => setQuarterPizzaToAdd(null)}
              onConfirm={handleConfirmAddQuarterPizza}
            />
            {mastroBuilderState.isOpen && (
              <MastroBuilderModal 
                baseItem={mastroBuilderState.baseItem} 
                onClose={closeMastroBuilder} 
                onConfirm={handleConfirmMastroPizza} 
              />
            )}
            
            {/* Mobile-only Bottom Nav */}
            <BottomNav view={view} setView={handleSetView} cartCount={cartCount} />
          </div>
        );
      }

      // --- RENDER ---
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
